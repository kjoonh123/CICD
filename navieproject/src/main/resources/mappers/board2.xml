<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="world.navie.www.board2.BoardMapper2">
	<resultMap type="world.navie.www.board2.BoardDTO2" id="board">
		<result column="write_date" property="writeDate"/>
		<result column="file_name" property="fileName"/>
	</resultMap>
	
	<select id="boardForm" resultMap="board">
		SELECT B.*
		FROM (
		    SELECT A.*, ROW_NUMBER() OVER (ORDER BY no DESC) as r
		    FROM board2 A
		) B
		WHERE B.r BETWEEN #{begin} AND #{end};
<!-- 	SELECT B.* FROM ( SELECT ROWNUM as r, A.* FROM 
		( SELECT board.* FROM board2 ORDER BY no DESC )A )B 
		WHERE B.r BETWEEN #{begin} AND #{end}
 -->
	</select>
	
	<select id="totalCount">
		SELECT count(no) FROM board2
	</select>
	
	<insert id="boardWriteProc">
		<selectKey order="BEFORE" keyProperty="no" resultType="int">
			<!-- SELECT NVL(max(no), 0)+1 FROM board2 -->
			SELECT COALESCE(MAX(no), 0) + 1 FROM board2
		</selectKey>
		INSERT INTO board2
		VALUES(#{no}, #{title}, #{content}, #{id}, #{writeDate}, 0, #{fileName})
	</insert>
	
	<select id="boardContent" resultMap="board">
		SELECT * FROM board2 WHERE no=#{n}
	</select>
	
	<update id="incrementHits">
		UPDATE board2 SET hits=hits+1 WHERE no=#{n}
	</update>
	
	<select id="boardDownload">
		SELECT file_name FROM board2 WHERE no=#{n}
	</select>	
	
	<update id="boardModifyProc">
		UPDATE board2 SET title=#{title}, content=#{content} WHERE no=#{no}
	</update>
	
	<delete id="boardDeleteProc">
		DELETE FROM board2 WHERE no=#{n}
	</delete>

</mapper>